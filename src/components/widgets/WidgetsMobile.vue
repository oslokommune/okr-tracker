<template>
  <aside v-if="activeItem">
    <div class="widgets">
      <widget-dashbord-entry :slug="activeItem.slug" />
      <widget-admin />
      <widget-wrapper
        v-if="activePeriod || activeObjective"
        :title="
          $t(
            `widget.progression.${
              $route.name === 'ItemHome' ? 'period' : 'objective'
            }`
          )
        "
      >
        <progression-chart :progression="progression" />
      </widget-wrapper>
      <widget-mission-statement />
      <widget-team />
      <widget-child-items />
      <widget-weights
        v-if="activePeriod || activeObjective"
        :active-item="
          $route.name === 'ItemHome' ? activePeriod : activeObjective
        "
        :items="$route.name === 'ItemHome' ? objectives : keyResults"
        :type="$route.name === 'ItemHome' ? 'objective' : 'keyResult'"
      />
      <widget-objective-details v-if="$route.name === 'ObjectiveHome'" />
    </div>
  </aside>
</template>

<script>
import { mapState } from 'vuex';
import WidgetMissionStatement from '@/components/widgets/WidgetMissionStatement.vue';
import WidgetTeam from '@/components/widgets/WidgetTeam/WidgetTeam.vue';
import WidgetChildItems from '@/components/widgets/WidgetChildItems.vue';
import WidgetWeights from '@/components/widgets/WidgetWeights.vue';
import WidgetAdmin from '@/components/widgets/WidgetAdmin.vue';
import WidgetObjectiveDetails from '@/components/widgets/WidgetObjectiveDetails.vue';

export default {
  name: 'WidgetsMobile',

  components: {
    WidgetMissionStatement,
    ProgressionChart: () => import('@/components/ProgressionChart.vue'),
    WidgetWrapper: () => import('./WidgetWrapper.vue'),
    WidgetTeam,
    WidgetChildItems,
    WidgetWeights,
    WidgetAdmin,
    WidgetObjectiveDetails,
    WidgetDashbordEntry: () =>
      import('@/components/widgets/WidgetDashbordEntry.vue'),
  },

  computed: {
    ...mapState([
      'activeItem',
      'activePeriod',
      'objectives',
      'keyResults',
      'activeObjective',
    ]),

    progression() {
      if (this.$route.name === 'ItemHome') {
        return this.activePeriod?.progression;
      }

      return this.activeObjective?.progression;
    },
  },
};
</script>

<style scoped></style>
